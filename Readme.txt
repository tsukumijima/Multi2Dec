
− Multi2Dec Ver.2.10 −


１．概要
　　・BonシリーズのMPEG2-TS処理エンジンを使用したMulti2スクランブル解除のサンプルプログラムです。
　　　本ソフトウェアはMPEG2システムの試験又は研究の目的に限りフリーウェアとして提供しております。

　　　Multi2DecWin.exe　　Windows GUI版
　　　Multi2DecDos.exe　　コンソール版
　　　B25Decoder.dll　　　汎用DLL版


２．動作環境
　　・Windowsから利用可能なスマートカードリーダ及び正規にライセンスされたB-CASカード。
　　　※スクランブル解除及び契約情報更新を行う場合のみ必要。(TSエラーチェックには不要)

　　・WindowsXP SP3 以上
　　　※本ソフトウェアの動作には「Microsoft Visual C++ 2005 SP1 再頒布可能パッケージ」が必要です。
　　　　起動時にエラーが表示される場合は下記をダウンロードしてインストールしてください。

　　　　http://www.microsoft.com/downloads/details.aspx?displaylang=ja&FamilyID=200b2fd9-ae1a-4a14-984d-389c36f85647

　　　※Multi2DecWin.exe及びMulti2DecDos.exeの動作には下記Bonモジュールが必要です。(同梱しています)

　　　　bon_CoreEngine.dll      Ver.1.0.0.0
　　　　bon_MediaDecoder.dll    Ver.1.0.0.3
　　　　bon_BcasDriver.dll      Ver.1.0.0.0
　　　　bon_TsConverter.dll     Ver.1.1.0.0


３．注意事項
　　・本ソフトウェアは正規にライセンスされたB-CASカードを用いることにより復号を行います。
　　・B-CASカードを許可された機器以外で使用することはB-CASカードの契約約款に抵触する可能性があるため、
　　　本ソフトウェアは自己の責任において使用して下さい。
　　・本ソフトウェアは下記「公開規格」の技術情報に基づき「正規の手法」を用いて実装されています。
　　・本ソフトウェアを使用することによりいかなる著作物の「技術的保護手段」も回避することはできません。
　　・本ソフトウェアは技術的検証を目的としたサンプルプログラムであり、第三者の知的財産権の侵害を幇助する
　　　可能性のある目的に使用されることを作者は一切意図しておらず、またこれらの行為を禁止します。
　　・本ソフトウェアにより復号を行ったトランスポートストリームは著作権法30条1項の定める私的使用を目的とした
　　　複製に限り、ハードディスク等へ記録することができます。但しCD-R/RW、DVD-R/RW/RAM、D-VHS等政令で定める
　　　メディアに記録する場合は私的録音録画補償金制度の対象となるため、自己の責任において行ってください。
　　・本ソフトウェアにより復号を行ったトランスポートストリームを著作者の許可なくアップロード可能な状態に
　　　する行為は著作権法23条1項が定める送信可能化権侵害の可能性があり処罰の対象となります。
　　・本ソフトウェアは「無償」で提供される「フリーウェア」です。
　　・本ソフトウェアはARIB規格への適合を保障しておりません、またいかなる種別の製品にも該当しません。
　　・本ソフトウェアを使用した結果発生したいかなる損害も作者は責任を負うことはできません。
　　・本ソフトウェアは特許法第69条第1項が定める「試験又は研究」の目的に限り使用することができます。
　　・本ソフトウェアを製品に組み込む場合は係る特許権利者と個別のライセンス契約を締結する必要があります。
　　・本サンプルプログラムのソースコードの取り扱いはGPLに従うこととします。

　　これらの注意事項に同意頂ける場合にのみ、本ソフトウェアの使用を許可致します。


４．構成について
　　・Multi2DecはBonフレームワークを利用して構成されています。
　　・TSファイル復号処理はBonモジュールbon_TsConverter.dllにBonクラスとして実装されています。
　　・CTsDescramblerのバッファリングモードを使用してファイル先頭の復号漏れを防止しています。


５．使用方法

　−Multi2DecWin−
　　１．入力ファイルをウィンドウにドラッグするか「ファイル追加」メニューにより登録します。
　　２．プリセットドロップダウンリストから実行したい処理を選択します。
　　３．「処理開始」ボタンをクリックすると処理が開始されます。

　　※「設定」メニューの「ユーザ定義」で詳細な設定が可能です。


　−Multi2DecDos−
　　・コマンドプロンプトまたはバッチファイルから利用します。

　　　Multi2DecDos [[/D | /C | /U] | [/OUT] [/B25] [/EMM] [/PURE] [/NULL]] [/N] InputFile [OutputFile]

　　　  /D          スクランブル解除を行います。(デフォルト動作)
　　　  /C          TSファイルのエラーチェックを行います。
　　　  /U          B-CASカードの契約情報の更新を行います。(EMM処理)

　　　　下記オプションは/D /C /Uを指定しない場合のみ有効です。(ユーザ定義の処理)

　　　  /OUT        ファイルを出力します。
　　　  /B25        Multi2復号を行います。
　　　  /EMM        EMM処理を行います。(/B25と同時に使用したときのみ有効)
　　　  /PURE       復号できなかったパケットを出力しません。
　　　  /NULL       NULLパケットを出力しません。
　　　  /N          ログファイルを出力しません。
　　　  InputFile   入力ファイル名
　　　  OutputFile  出力ファイル名(省略した場合は入力ファイル名に「_dec」のサフィックスが付加されます)


６．ライセンスについて
　　・本パッケージに含まれる全てのソースコード、バイナリについて著作権は一切主張しません。
　　・オリジナルのまま又は改変し、各自のソフトウェアに自由に添付、組み込むことができます。
　　・但し上記を行う場合は少なくとも改変部分のソースコードの添付を要求します。
　　・B25Decoder.dllのライセンスについてはB25DecoderSDKフォルダ内にあるドキュメントを参照してください。

　　・ビルドに必要な環境
　　　- Microsoft Visual Studio 2005 以上　(Multi2DecWinのみMFCも必要)
　　　- Microsoft Windows SDK v6.0 以上


７．参考文献
　　・ARIB STD-B10
　　・ARIB STD-B24
　　・ARIB STD-B25
　　・ARIB STD-B32
　　・ISO/IEC 11172-3
　　・ISO/IEC 13818-1
　　・ISO/IEC 13818-2
　　・ISO/IEC 13818-7

　　・まるも製作所「ARIB STD-B25 仕様確認テストプログラム」
　　・Meru氏「CapUSB M-Edition」
　　・作者不明「Mpeg2-TSのストリームからデータ放送情報を抽出するテスト」
　　・Microsoft DirectX 9.0「PSI パーサー フィルタ サンプル」他


８．サポート、連絡先
　　　連絡先　　：　拡張ツール中の人　　nakanohito@2sen.dip.jp
　　　公式サイト：　http://2sen.dip.jp/dtv/


９．更新履歴
　Ver.2.10 ・バッファリングを行うことでファイル先頭の復号漏れを防止した。
　　　　　 ・MULTI2の復号を若干高速化。
　　　　　 ・ライセンスを一部緩和。

　Ver.2.03 ・EMMが処理できない不具合修正。

　Ver.2.02 ・異なるネットワークのストリームを連続して入力した場合に例外が発生する不具合を修正。

　Ver.2.01 ・ログファイルにおいて日本語を含むファイル名が文字化けしていたのを修正。
　　　　　 ・ファイルリストをダブルクリックするとログファイルを開くようにした。
　　　　　 ・ファイルリストのファイルが1つだけの場合にリストから削除できなかった不具合修正。
　　　　　 ・ファイルリストにファイルを1つだけの場合にログファイルを開けなかった不具合修正。
　　　　　 ・TSエラーチェックの場合はログファイルにInputパケット数を出力しないようにした。
　　　　　 ・コンソール版のメッセージを日本語化した。
　　　　　 ・PID 0x0000のパケットが1つ余分にカウントされる不具合修正。(逆に別のPIDは1つ少ない)

　Ver.2.00 ・Bonフレームワークを利用したプログラムとして新規に作り直した。
　　　　　 ・EMM処理に対応した。(安全のため7日以上前のTSファイルには適用されません)
　　　　　 ・188バイト以外のTSファイルにも対応した。(出力は必ず188バイトになります)
　　　　　 ・ファイルアクセスのバッファリング、非同期化により処理速度を向上した。
　　　　　 ・ログファイルを出力できるようにした。

　Ver.1.21 ・PMTのDescriptors Fieldに複数のDescriptorが含まれている場合に復号できなかった不具合修正。
　　　　　　 →Descriptors Fieldを抽象化したクラスを追加しこれに伴うインタフェースの変更も行った。
　　　　　 ・CTsPacketParserのデフォルトでNULLパケットを出力しないようにした。(出力設定も可能)

　Ver.1.20 ・BonTsEngine更新
　　　　　　　- CMediaDecoder派生クラス間で転送されるCMediaDataを動的に生成しないようにした。
　　　　　　　　→メモリ確保/開放のオーバーヘッドが無くなったためパフォーマンスが向上。
　　　　　　　- スクランブル解除できなかったパケットも出力するようにした。(Meru氏の指摘反映)
　　　　　　　- ECM処理に失敗した場合は1度だけB-CASカードの初期化を試行するようにした。(Meru氏の指摘反映)
　　　　　　　- その他バグフィックス、調整多数

　Ver.1.10 ・途中でネットワーク変更を含むストリームが入力された場合に正常に復号できなくなることがあった
　　　　　　 不具合を修正。(BonTsEngine更新)
　　　　　 ・その他微調整。
　　　　　 ・ライセンスを一部変更。(B25Decoder.dllを添付する場合はソースコードの開示を不要にした)

　Ver.1.03 ・初回リリース
